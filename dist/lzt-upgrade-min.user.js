// ==UserScript==
// @name [Development Build] LZT Upgrade
// @description A free extension for Lolzteam with many useful features
// @description:ru Бесплатное расширение для Lolzteam с множеством полезных функций
// @version 2.0.0dev
// @author Toil
// @supportURL https://github.com/lzt-upgrade/lzt-upgrade/issues
// @match *://lolz.guru/*
// @match *://lolz.live/*
// @match *://zelenka.guru/*
// @match *://lzt.market/*
// @match *://lolz.market/*
// @connect lztupgrade.toiloff.ru
// @connect greasyfork.org
// @downloadURL https://github.com/lzt-upgrade/lzt-upgrade/raw/master/dist/lzt-upgrade.user.js
// @grant GM_xmlhttpRequest
// @grant GM_info
// @grant GM_addStyle
// @grant GM_setValue
// @grant GM_getValue
// @grant GM_deleteValue
// @grant GM_listValues
// @homepageURL https://github.com/lzt-upgrade/lzt-upgrade
// @icon https://cdn.jsdelivr.net/gh/lzt-upgrade/lzt-upgrade@latest/src/images/logo-mini.png
// @license MIT
// @namespace lztupgrade
// @require https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js
// @require https://raw.githubusercontent.com/lzt-upgrade/coloris-lzt-theme/main/dist/coloris.js
// @require https://raw.githubusercontent.com/lzt-upgrade/lzt-upgrade/2.0.0/libs/purify3.0.3.min.js
// @require https://raw.githubusercontent.com/lzt-upgrade/lzt-upgrade/2.0.0/libs/Sortable1.15.0.min.js
// @run-at document-start
// @updateURL https://github.com/lzt-upgrade/lzt-upgrade/raw/master/dist/lzt-upgrade.user.js
// ==/UserScript==

/*! For license information please see lzt-upgrade-min.js.LICENSE.txt */
(()=>{"use strict";var e={"./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/styles/buttons.scss":(e,t,n)=>{n.d(t,{Z:()=>i});var a=n("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),r=n.n(a),o=n("./node_modules/css-loader/dist/runtime/api.js"),s=n.n(o)()(r());s.push([e.id,"#LZTUpButton{color:#0daf77;font-weight:600}",""]);const i=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/styles/errorPage.scss":(e,t,n)=>{n.d(t,{Z:()=>i});var a=n("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),r=n.n(a),o=n("./node_modules/css-loader/dist/runtime/api.js"),s=n.n(o)()(r());s.push([e.id,".LZTUpErrorPage{background-color:#272727}.LZTUpErrorPage article{color:#d6d6d6}.LZTUpErrorPage article div{display:flex;flex-direction:column;justify-content:center;align-items:center}.LZTUpErrorPage article div .LZTUpErrorPageSelfAd{border-top:1px solid #363636}.LZTUpErrorPage article div .LZTUpErrorPageSelfAd .selfAd{font-size:18px;color:#949494;max-width:75%;text-align:center}.LZTUpErrorPage article div .LZTUpErrorPageSelfAd .buttons{display:flex;flex-direction:row}.LZTUpErrorPage article div .LZTUpErrorPageSelfAd .buttons .button{display:flex;align-items:center;background:#0daf77;border-radius:6px;color:#fff;padding:0px 15px;margin:10px;line-height:34px;font-size:18px;transition:.5s background ease}.LZTUpErrorPage article div .LZTUpErrorPageSelfAd .buttons .button:hover{background:rgba(13,175,119,.8) !important}.LZTUpErrorPage article div .LZTUpErrorPageSelfAd .buttons .button svg{width:24px;height:24px;margin-right:5px;fill:#fff}",""]);const i=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/styles/menu.scss":(e,t,n)=>{n.d(t,{Z:()=>i});var a=n("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),r=n.n(a),o=n("./node_modules/css-loader/dist/runtime/api.js"),s=n.n(o)()(r());s.push([e.id,"@import url(https://cdn.jsdelivr.net/gh/lzt-upgrade/coloris-lzt-theme@latest/dist/coloris.min.css);"]),s.push([e.id,'.clr-picker{display:none}.LZTUpColorPickerWrap{display:flex;align-items:center}.LZTUpColorPickerWrap:not(:first-of-type){margin-top:10px}.LZTUpColorPickerWrap .LZTUpModalDescription{margin-right:10px !important}.LZTUpColorPickerWrap .clr-field input{width:24px;height:24px}.LZTUpColorPickerWrap .clr-field button{width:28px;height:28px}.LZTUpColorPickerWrap .clr-field input,.LZTUpColorPickerWrap .clr-field button{border-radius:4px}.LZTUpSelect option{background:#272727;padding:10px 15px;font-weight:600;border-radius:6px}.LZTUpSelect option:hover{background:#2d2d2d}.LZTUpIconButton{display:flex;flex-direction:row-reverse;align-items:center;justify-content:center}.LZTUpIconButton.fit{max-width:fit-content}.LZTUpIconButton i{margin:0 8px;margin-top:3.5px}.LZTUpRefreshButton{min-width:32px !important;margin-left:32px !important}.LZTUpSortableItem{display:flex;align-items:center;padding:16px;margin:8px 0;border-radius:8px;background:rgba(54,54,54,.75)}.LZTUpSortableItem .LZTUpSortableDraggable{color:#8c8c8c;margin-right:10px;cursor:move}.LZTUpSortableItem .LZTUpSortableContent p{margin:0 !important}.LZTUpSortableItem .LZTUpSortableUtility{display:flex;margin-left:auto}.LZTUpSortableItem .LZTUpSortableUtility div{margin-left:10px;cursor:pointer;transition:.5s color ease}.LZTUpSortableItem .LZTUpSortableUtility .LZTUpSortableEditButton{color:#6a6a6a}.LZTUpSortableItem .LZTUpSortableUtility .LZTUpSortableEditButton:hover{color:#0daf77}.LZTUpSortableItem .LZTUpSortableUtility .LZTUpSortableRemoveButton{color:#964448}.LZTUpSortableItem .LZTUpSortableUtility .LZTUpSortableRemoveButton:hover{color:#f13838}#LZTUpModalMainTitle{text-align:center;padding:16px;font-size:20px;font-weight:bold}.LZTUpModalBackButton{position:absolute;top:18px;left:25px;padding:0px 5px;margin:-4px -5px;cursor:pointer;line-height:25px;height:26px;width:26px;border:0 !important;background:rgba(0,0,0,0);color:#d6d6d6;font-size:18px}.LZTUpModalBackButton:hover{background:rgba(18,76,50,.4);border-radius:8px}.LZTUpTabs{width:100%;box-sizing:border-box;padding:0 10px;border:none !important;margin:15px auto !important;display:flex;align-items:center;justify-content:center}.LZTUpTabs #LZTUpTab{position:relative;padding:10px;margin:0 4px;float:left;font-weight:600;list-style:none;font-size:14px}.LZTUpTabs #LZTUpTab:hover{cursor:pointer}.LZTUpTabs #LZTUpTab.active{box-shadow:inset 0px -2px 0px 0px #0daf77;transform:translateY(-1px);transition:.2s}.LZTUpTabs #LZTUpTab:not(.active):hover{box-shadow:inset 0px -2px 0px 0px #363636}.LZTUpSection{display:flex;flex-wrap:wrap;margin:20px 15px}.LZTUpSection.row{flex-direction:row}.LZTUpSection.row .LZTUpSectionItem{max-width:284px}.LZTUpSection.row .LZTUpSectionTitle,.LZTUpSection.row .LZTUpSectionDesc{max-width:200px}.LZTUpSection.column{flex-direction:column}.LZTUpSection.column .LZTUpSectionTitle,.LZTUpSection.column .LZTUpSectionDesc{max-width:440px}.LZTUpSection.column .LZTUpSectionDesc{white-space:break-spaces}.LZTUpSection.column .LZTUpSectionItem{max-width:580px}.LZTUpSection .LZTUpSectionItem{flex-basis:50%;flex-grow:1;height:64px;display:flex;align-items:center;transition:all .5s ease}.LZTUpSection .LZTUpSectionItem:hover{background:rgba(54,54,54,.75);border-radius:8px;cursor:pointer}.LZTUpSectionTextContainer{display:flex;flex-direction:column;justify-content:center;flex:1 1 auto;max-width:100%}#LZTUpIcon{width:28px;height:28px;margin:20px;font-size:28px;color:#0daf77}#LZTUpIcon.gray{color:#949494}#LZTUpIcon.right{text-align:right}#LZTUpModalContainer{margin:15px;max-width:400px}#LZTUpModalChecksContainer,#LZTUpModalReportButtonsContainer,#LZTUpModalCell,.LZTUpModalMesh,.LZTUpModalSeparator{margin:15px;max-width:95%}.LZTUpContainer{display:flex;flex-direction:column;margin:15px;max-width:95%}.LZTUpModalHeading{margin:10px 0 5px 0 !important}.LZTUpModalDescription{margin:0 !important;margin-bottom:5px !important}.LZTUpTextArea{min-height:40px}.LZTUpModalSeparator{border-bottom:1px solid #363636}#LZTUpModalChecksText{margin:0px 25px 5px}.LZTUpSectionTitle,.LZTUpSectionDesc{display:block;margin-right:20px;font-size:15px;font-weight:bold;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.LZTUpSectionDesc{font-size:13px;font-weight:normal;color:#949494}.LZTUpSectionDesc .mceSmilie{max-height:18px !important}.LZTUpModalSectionTexts{display:flex;flex-direction:column;justify-content:center;flex:1 1 auto}.LZTUpModalSectionTexts .LZTUpSubText{max-width:450px}#LZTUpModalComment{background:#363636;margin:5px 15px;padding:10px 15px;border-radius:10px}#LZTUpModalComment a{color:#00ba78}.LZTUpModalBlock{display:flex}.LZTUpModalBlockButtons{display:flex;flex-wrap:wrap;justify-content:center;margin-top:25px}.LZTUpModalBlockButtons .button{margin:5px;width:250px}.LZTUpSubMenu .previewContainer{display:flex;float:right;margin:25px 15px;padding:10px 10px 15px 10px;background-size:cover;background-position:center;background-attachment:fixed;background-repeat:no-repeat;border-radius:10px;width:92%;max-width:92%}.LZTUpSubMenu .previewContainer .avatar img{width:66px;height:66px}.LZTUpSubMenu .previewContainer .info{padding:0 0 0 20px}.LZTUpSubMenu .previewContainer .info .username{font-weight:600}.LZTUpSubMenu .previewContainer .bannerOrStatus{min-width:150px;margin:10px 0 0;color:#949494}.LZTUpSubMenu .previewContainer .bannerOrStatus em{font-style:inherit}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge .customUniqIcon{padding:2px 0;text-align:center}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge .customUniqIcon svg{width:16px !important;height:16px !important}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge::before{font-family:"Font Awesome 5 Pro";font-weight:600;display:inline-block;font-size:12.32px}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.admin{background:#964448}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.admin::before,.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.bot::before{content:""}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.Designer::before{content:""}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.headDesigner::before{content:""}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.editor::before{content:""}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.sponsor::before{content:""}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.coder::before{content:""}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.uniq_default::before,.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.Legend::before,.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.Ikarus::before{content:""}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.moder{background:#3d6b39}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.curator{background:rgba(8,156,122,.8509803922)}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.moder::before,.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.main_moder::before,.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.curator::before{content:""}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.arbitr::before,.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.main_arbitr::before{content:""}.LZTUpSubMenu .previewContainer #LZTUpPreviewBadge.telegramBot::before{content:""}.LZTUpSubMenu .previewContainer .UsernameStyle.style18,.LZTUpSubMenu .previewContainer .UsernameStyle.style360{text-decoration:line-through;color:#aaa}.LZTUpSubMenu .previewContainer .UsernameStyle.style3{color:#f13838}.LZTUpSubMenu .previewContainer .UsernameStyle.style30{color:#ff9afc}.LZTUpSubMenu .previewContainer .UsernameStyle.style353{background:linear-gradient(98.26deg, #FF42F7 2.08%, #FF24CF 100%);-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0)}.LZTUpSubMenu .previewContainer .UsernameStyle.style350{background:linear-gradient(90deg, #5c45ff, #feb5f2 100%);-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0)}.LZTUpSubMenu .previewContainer .UsernameStyle.style12{color:#01f73c}.LZTUpSubMenu .previewContainer .UsernameStyle.style1,.LZTUpSubMenu .previewContainer .UsernameStyle.style41,.LZTUpSubMenu .previewContainer .UsernameStyle.style142,.LZTUpSubMenu .previewContainer .UsernameStyle.style144{color:#aaa}.LZTUpSubMenu .previewContainer .UsernameStyle.style32,.LZTUpSubMenu .previewContainer .UsernameStyle.style93,.LZTUpSubMenu .previewContainer .UsernameStyle.style21,.LZTUpSubMenu .previewContainer .UsernameStyle.style2{color:#949494}.LZTUpSubMenu .previewContainer .UsernameStyle.style60{color:#ffa8af}.LZTUpSubMenu .previewContainer .UsernameStyle.style9{color:#0075ad}.LZTUpSubMenu .previewContainer .UsernameStyle.style65{color:#a5e3ff}.LZTUpSubMenu .previewContainer .UsernameStyle.style351{color:#ff0076}.LZTUpSubMenu .previewContainer .UsernameStyle.style29{color:#0acc9e}.LZTUpSubMenu .previewContainer .UsernameStyle.style26{background:linear-gradient(90deg, #0095dd 0%, #f1094b 100%, #0095dd);-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0)}.LZTUpSubMenu .previewContainer .UsernameStyle.style4{color:#0e9100}.LZTUpSubMenu .previewContainer .UsernameStyle.style22{color:#eee}.LZTUpSubMenu .previewContainer .UsernameStyle.style11{color:#56b5e0}.LZTUpSubMenu .previewContainer .UsernameStyle.style7{color:#ff9304}.LZTUpSubMenu .previewContainer .UsernameStyle.style349,.LZTUpSubMenu .previewContainer .UsernameStyle.style365{color:#0087ff}.LZTUpSubMenu .previewContainer .UsernameStyle.style354{color:aqua}.LZTUpSubMenu .previewContainer .UsernameStyle.style218{color:#f13838}.LZTUpSubMenu .previewContainer .UsernameStyle.style359{color:#e5d9a3}.LZTUpSubMenu .previewContainer .UsernameStyle.style8{color:gold}.LZTUpSubMenu .previewContainer .UsernameStyle.style265{background:linear-gradient(35deg, #006eff, #00ff81 52%, #fff 50%, #93cbff);-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0);text-shadow:0 0 7px rgba(0,255,207,.5019607843)}.LZTUpSubMenu .previewContainer .UsernameStyle.style23{color:#b35ede}.LZTUpSubMenu .previewContainer .UsernameStyle.banned,.LZTUpSubMenu .previewContainer .UsernameStyle.is_banned{text-decoration:line-through;background:inherit;-webkit-text-fill-color:inherit;text-shadow:inherit !important;color:#aaa !important}.LZTUpSubMenu .previewContainer .avatarBox{position:relative}.LZTUpSubMenu .previewContainer .avatarBox .avatarUserBadges .badgeDefaultBackground{background:#363636}.LZTUpSubMenu .previewContainer .avatarBox .avatarUserBadges .avatarUserBadge{position:absolute;bottom:-12px;left:20px;border:2px solid #272727;font-size:0;width:22px;height:22px;margin:0;line-height:22px;border-radius:50%;text-align:center;text-shadow:none !important;box-shadow:none !important;border-radius:50% !important;-webkit-background-clip:unset !important;-webkit-text-fill-color:unset !important;overflow:hidden}.LZTUpSubMenu .previewContainer .avatarBox .avatarUserBadges .avatarUserBadge:only-child{left:35px}.LZTUpSubMenu .previewContainer .avatarBox .avatarUserBadges .avatarUserBadge.avatarUserBadge--1{left:20px}.LZTUpSubMenu .previewContainer .avatarBox .avatarUserBadges .avatarUserBadge.avatarUserBadge--2{left:40px}.LZTUpSubMenu .previewContainer .avatarBox,.LZTUpSubMenu .previewContainer .info{display:table-cell;vertical-align:top}',""]);const i=s},"./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/styles/universal.scss":(e,t,n)=>{n.d(t,{Z:()=>i});var a=n("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),r=n.n(a),o=n("./node_modules/css-loader/dist/runtime/api.js"),s=n.n(o)()(r());s.push([e.id,"#LZTUpCustomBackground{background-size:cover;background-position:center;background-attachment:fixed;background-repeat:no-repeat}",""]);const i=s},"./node_modules/css-loader/dist/runtime/api.js":e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(a)for(var i=0;i<this.length;i++){var c=this[i][0];null!=c&&(s[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);a&&s[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),t.push(d))}},t}},"./node_modules/css-loader/dist/runtime/noSourceMaps.js":e=>{e.exports=function(e){return e[1]}},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":e=>{var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var o={},s=[],i=0;i<e.length;i++){var c=e[i],l=a.base?c[0]+a.base:c[0],d=o[l]||0,u="".concat(l," ").concat(d);o[l]=d+1;var p=n(u),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)t[p].references++,t[p].updater(m);else{var h=r(m,a);a.byIndex=i,t.splice(i,0,{identifier:u,updater:h,references:1})}s.push(u)}return s}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=a(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var i=n(o[s]);t[i].references--}for(var c=a(e,r),l=0;l<o.length;l++){var d=n(o[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=c}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":e=>{var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,r&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={id:a,exports:{}};return e[a](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,(()=>{const e=JSON.parse('{"RC":"https://lztupgrade.toiloff.ru/api/themes","I1":"https://lztupgrade.toiloff.ru/static/themes"}');function t(e){return new Promise((t=>{if(document.querySelector(e))return t(document.querySelector(e));const n=new MutationObserver((()=>{document.querySelector(e)&&(t(document.querySelector(e)),n.disconnect())}));n.observe(document.body,{childList:!0,subtree:!0})}))}async function a(e,t=15e3){const n=Date.now();for(;Date.now()-n<t;){const a=$(e);if(a&&a.length||Date.now()-n>t)return a;await new Promise((e=>setTimeout(e,1e3)))}return null}const r=e=>new Promise((t=>setTimeout(t,e)));function o(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function s(e,t){return t?.length>1&&t?.startsWith(".")?(t=t.replace(".",""),e.classList.add(t)):e.style=t}const i={extName:"LZT Upgrade Development Build",cacheTime:604800},c={nodes:{contests:".node766"},selectors:{memberCard:".xenOverlay.memberCard"},uiElementsId:{lztupTempSubMenu:"LZTUpTempSubMenu"},uiElementsSelectors:{lztupTempSubMenu:"#LZTUpTempSubMenu"},links:{telegramChannel:"https://t.me/lzt_upgrade",githubPage:"https://github.com/lzt-upgrade/lzt-upgrade"},infoLinks:[{icon:"far fa-donate",title:"Поддержать разработку",desc:'Можете немного закинуть, если хотите <img src="/styles/default/xenforo/smilies/ok_lol.png" class="mceSmilie" alt=":ok_lol:" title="Lol">',href:"https://lzt.market/balance/transfer?redirect=https%3A%2F%2Fzelenka.guru&username=Toil",sectionId:"LZTUpInfoDonateItem"},{icon:"far fa-comments",title:"Тема на форуме",desc:"Новости об обновлениях и отзывы других пользователей",href:"https://zelenka.guru/threads/1",sectionId:"LZTUpInfoThreadItem"},{icon:"fab fa-telegram-plane",title:"Telegram канал",desc:"Все новости расширения и анонсы новых функций",href:"https://t.me/lzt_upgrade",sectionId:"LZTUpInfoTGChannelItem"},{icon:"fab fa-telegram-plane",title:"Telegram чат",desc:"Чатик для общения с другими пользователями расширения",href:"https://t.me/lzt_upgrade_chat",sectionId:"LZTUpInfoTGChatItem"},{icon:"fab fa-github",title:"Github",desc:"Исходники расширения + все версии расширения",href:"https://github.com/lzt-upgrade/lzt-upgrade",sectionId:"LZTUpInfoGithubItem"},{icon:"far fa-code-branch",title:"Greasy Fork",desc:"Альтернативный источник для установки расширения",href:"https://github.com/lzt-upgrade/lzt-upgrade",sectionId:"LZTUpInfoGreasyForkItem"}]},l={};function d(e){e&&function(e,n=1e3){t(".LztContest--Participate").then((a=>{l.debug("onParticipateHandler: Participate button finded"),a.addEventListener("click",(async()=>{if(l.debug("onParticipateHandler: click contest button"),a.classList.contains("disabled"))l.debug("onParticipateHandler: clicked on disabled contest button");else{if(l.debug("onParticipateHandler: waiting for alreadyParticipate button"),!await t("span.alreadyParticipate"))return void l.debug("onParticipateHandler: no alreadyParticipate button");l.debug("onParticipateHandler: alreadyParticipate button finded"),await r(n),e()}}))})).catch((e=>{l.debug("onParticipateHandler: no contest button")}))}((()=>{window.close()}))}l.log=(...e)=>console.log("%c[LZT Upgrade]","background: #0daf77; color: #fff; padding: 5px;",...e),l.error=(...e)=>console.error("%c[LZT Upgrade]","background: #0daf77; color: #fff; padding: 5px;",...e),l.warn=(...e)=>console.warn("%c[LZT Upgrade]","background: #0daf77; color: #fff; padding: 5px;",...e),l.info=(...e)=>console.info("%c[LZT Upgrade]","background: #0daf77; color: #fff; padding: 5px;",...e),l.debug=(...e)=>{};class u{constructor(e,t,n=1,a={},r={}){this.name=e,this.objectKey=t,this.version=n,this.indexes=a,this.defaultData=r}checker(e,...t){let n=!1;if("object"!=typeof arguments[1])return n;for(const t of Object.entries(arguments[1]))!t[0].toString()in e||typeof t[1]===e[t[0].toString()]&&(n=!0);return n}callback(e,t,n){if("object"!=typeof n)return response;for(const a of Object.entries(n))!a[0].toString()in e||typeof a[1]===e[a[0].toString()]&&(t[a[0].toString()]=a[1]);return t}open(){return indexedDB.open(this.name,this.version)}async delete(){return indexedDB.deleteDatabase(this.name)}async init(){return new Promise(((e,t)=>{const n=this.open();n.onerror=()=>{console.log(n),alert(`LZT Upgrade: Произошла ошибка при инициализации Базы Данных ${this.name}`),l.error(`Ошибка инициализации Базы Данных ${this.name}: `,n.errorCode),t(!1)},n.onupgradeneeded=()=>{const a=n.result;a.onerror=()=>{alert(`LZT Upgrade: Не удалось загрузить базу данных ${this.name}`),l.error(`Не удалось загрузить базу данных ${this.name}: `,n.error),t(!1)};const r=a.createObjectStore(this.objectKey,{keyPath:"key"});for(const e in this.indexes)void 0!==e&&r.createIndex(e,e,{unique:!1});l.log(`База Данных ${this.name} создана`),r.transaction.oncomplete=()=>{const n=a.transaction(this.objectKey,"readwrite").objectStore(this.objectKey).add(this.defaultData);n.onsuccess=()=>{l.log(`Стандартные настройки "${this.name}" добавлены в Базу Данных: `,n.result),e(!0)},n.onerror=()=>{l.error(`Ошибка при добавление стандартных настроек "${this.name}" в Базу Данных: `,n.error),t(!1)}}},n.onsuccess=()=>{l.log(`База данных ${this.name} инициализована`);const a=n.result;a.onversionchange=()=>{a.close(),alert(`LZT Upgrade: Базе данных ${this.name} необходимо обновление, пожалуйста, перезагрузите страницу.`),l.log(`Базе данных ${this.name} необходимо обновление, пожалуйста, перезагрузите страницу`),t(!1)},e(!0)},n.onblocked=()=>{const e=n.result;l.error(`База Данных ${this.name} временно заблокирована из-за ошибки: `,e),alert(`LZT Upgrade отключен из-за ошибки при обновление Базы Данных ${this.name}. Закройте все открытые вкладки с Lolzteam и попробуйте снова.`),t(!1)}}))}async read(){return new Promise(((e,t)=>{const n=this.open(this.name,this.version);n.onerror=()=>{alert(`LZT Upgrade: Произошла ошибка при чтение Базы Данных ${this.name}`),l.error(`Ошибка чтения Базы Данных ${this.name}: `,n.errorCode),t(!1)},n.onupgradeneeded=()=>{n.result.close(),this.init(),e(!0)},n.onsuccess=()=>{const a=n.result;a.onversionchange=()=>{a.close(),alert(`LZT Upgrade: Базе данных ${this.name} необходимо обновление, пожалуйста, перезагрузите страницу.`),l.log(`Базе данных ${this.name} необходимо обновление, пожалуйста, перезагрузите страницу`),t(!1)};const r=a.transaction(this.objectKey).objectStore(this.objectKey).get(this.objectKey);r.onerror=e=>{l.error(`Не удалось получить данные из Базы Данных ${this.name}: `,e.error),t(!1)},r.onsuccess=()=>{l.log(`Получены данные из Базы Данных ${this.name}: `,r.result);const t=r.result;e(t)}},n.onblocked=()=>{const e=n.result;l.error(`База Данных ${this.name} временно заблокирована из-за ошибки: `,e),alert(`LZT Upgrade отключен из-за ошибки при обновление Базы Данных ${this.name}. Закройте все открытые вкладки с Lolzteam и попробуйте снова.`),t(!1)}}))}async update(e){return new Promise(((t,n)=>{if(this.checker(this.indexes,e)){const a=this.open(this.name);a.onerror=()=>{alert(`LZT Upgrade: Произошла ошибка при обновление Базы Данных ${this.name}`),l.error(`Ошибка при обновление Базы Данных ${this.name}: `,a.errorCode),n(!1)},a.onupgradeneeded=()=>{a.result.close(),this.init(),t(!0)},a.onsuccess=()=>{const r=a.result;r.onversionchange=()=>{r.close(),alert(`LZT Upgrade: Базе данных ${this.name} необходимо обновление, пожалуйста, перезагрузите страницу.`),l.log(`Базе данных ${this.name} необходимо обновление, пожалуйста, перезагрузите страницу`),n(!1)};var o=r.transaction(this.objectKey,"readwrite").objectStore(this.objectKey),s=o.get(this.objectKey);s.onerror=e=>{l.error(`Не удалось получить данные из Базы Данных ${this.name}: `,e.error),n(!1)},s.onsuccess=()=>{l.log(`Получены данные из Базы Данных ${this.name}: `,s.result);let a=s.result;a=this.callback(this.indexes,a,e);const r=o.put(a);r.onerror=e=>{l.error(`Не удалось обновить данные в Базе Данных ${this.name}: `,e.error),n(!1)},r.onsuccess=()=>{l.log("Данные в Базе Данных обновлены, вы великолепны!"),t(!0)}}},a.onblocked=()=>{const e=a.result;l.error(`База Данных ${this.name} временно заблокирована из-за ошибки: `,e),alert(`LZT Upgrade отключен из-за ошибки при обновление Базы Данных ${this.name}. Закройте все открытые вкладки с Lolzteam и попробуйте снова.`),n(!1)}}else l.error("В чём смысл делать функцию добавления, которая ничего не добавляет?! wut"),n(!1)}))}}class p extends u{constructor(e="LZTUpAppear",t="appear",n=1){super(e,t,n,{hideUnreadArticleCircle:"number",hideTagsInThreads:"number",forumLogo:"number",hideCounterAlerts:"number",hideCounterConversations:"number",marketLogo:"number",reportButtonsInPost:"string",selectedTheme:"number",themeAutoReload:"number",backgroundEffect:"number",hideOnlyfans:"number",showPollResults:"number",newErrorPage:"number",selfAdOnNewErrorPage:"number"},{key:t,hideUnreadArticleCircle:0,hideTagsInThreads:0,forumLogo:0,hideCounterAlerts:0,hideCounterConversations:0,marketLogo:0,reportButtonsInPost:"",selectedTheme:0,themeAutoReload:0,backgroundEffect:0,hideOnlyfans:0,showPollResults:0,newErrorPage:1,selfAdOnNewErrorPage:1})}async update({hideUnreadArticleCircle:e,hideTagsInThreads:t,forumLogo:n,hideCounterAlerts:a,hideCounterConversations:r,marketLogo:o,reportButtonsInPost:s,selectedTheme:i,themeAutoReload:c,backgroundEffect:l,hideOnlyfans:d,showPollResults:u,newErrorPage:p,selfAdOnNewErrorPage:m}){super.update(...arguments)}}class m extends u{constructor(e="LZTUpContests",t="contests",n=1){super(e,t,n,{openTenContestsBtn:"number",infoTopInThread:"number",hideTagsInThread:"number",autoCloseOnParticipate:"number",removeContent:"number",removePoll:"number",updateCaptchaButton:"number",autoFixCaptcha:"number"},{key:t,openTenContestsBtn:0,infoTopInThread:0,hideTagsInThread:0,autoCloseOnParticipate:0,removeContent:0,removePoll:0,updateCaptchaButton:0,autoFixCaptcha:0})}async update({openTenContestsBtn:e,infoTopInThread:t,hideTagsInThread:n,autoCloseOnParticipate:a,removeContent:r,removePoll:o,updateCaptchaButton:s,autoFixCaptcha:i}){super.update(...arguments)}}class h extends u{constructor(e="LZTUpUsers",t="users",n=1){super(e,t,n,{showUserIdInProfile:"number",showUserIdInMemberCard:"number",showFullRegInProfile:"number",disableShareTyping:"number"},{key:t,showUserIdInProfile:0,showUserIdInMemberCard:0,showFullRegInProfile:0,disableShareTyping:0})}async update({showUserIdInProfile:e,showUserIdInMemberCard:t,showFullRegInProfile:n,disableShareTyping:a}){super.update(...arguments)}}class g extends u{constructor(e="LZTUpProfile",t="uniqueStyle",n=1){super(e,t,n,{usernameStyle:"string",bannerStyle:"string",bannerText:"string",badgeIcon:"string",badgeText:"string",badgeFill:"string",badgeStroke:"string",noticesMarks:"string",backgroundImage:"string",backgroundImageEverywhere:"number",badgeIcons:"object"},{key:t,usernameStyle:"",bannerStyle:"",bannerText:"",badgeIcon:"",badgeText:"",badgeFill:"",badgeStroke:"",noticesMarks:"",backgroundImage:"",backgroundImageEverywhere:0,badgeIcons:[]})}async update({usernameStyle:e,bannerStyle:t,bannerText:n,badgeIcon:a,badgeText:r,badgeFill:o,badgeStroke:s,noticesMarks:i,backgroundImage:c,backgroundImageEverywhere:l,badgeIcons:d}){super.update(...arguments)}}class f extends u{constructor(e="LZTUpSettings",t="settings",n=1){super(e,t,n,{checkUpdatesOnLoad:"number"},{key:t,checkUpdatesOnLoad:1})}async update({checkUpdatesOnLoad:e}){super.update(...arguments)}}function b(){return null!==document.querySelector("div.contestThreadBlock")}function y(){return window.location.pathname.includes("/forums/contests/")}function T(){return null!==document.querySelector("ol#ProfilePostList")}function w(){return null!==document.querySelector(c.selectors.memberCard)}function L(e=10){if(y()&&!$(`#openContestsButton${XenForo.htmlspecialchars(e)}`).length){const n=$("span.UpdateFeedButton.UpdateFeedButtonIcon"),a=$(`\n      <a class="button" id="openContestsButton${XenForo.htmlspecialchars(e)}">\n        Открыть ${XenForo.htmlspecialchars(e)}\n      </a>\n    `);a.on("click",(async()=>{if(n.click(),!await t("div.forumImprovements--mask.hidden"))return;const a=function(){let e=$("div.latestThreads");const t=$("div.stickyThreads");return e=t.is(":visible")?$.merge(e,t):e,e.find("div.discussionListItem--Wrapper")}().find("a.listBlock.main").toArray().map((e=>$(e).attr("href")));a.length&&$(a).map(((t,n)=>{if(t<=e){const e=window.open(`https://${window.location.hostname}/${n}`);e?e.focus():alert("Разрешите доступ к всплывающим окнам для этого сайта")}}))})),n.length&&n.parent().prepend(a)}}function U(e,t=5e3){return XenForo.alert(e,"",t)}function S(e){const t=new MutationObserver(((t,n)=>{for(const n of t)"childList"===n.type&&e(n)}));return t.observe(document.body,{childList:!0,subtree:!0}),t}function v(e,t="LZTUpIcon"){const n=document.createElement("i");return n.id=t,n.className=e,n}const Z=["color","text-shadow","border-radius","background","background-color","background-image","-webkit-background-clip","-webkit-text-fill-color"];function x(e){return DOMPurify.sanitize(e,{USE_PROFILES:{svg:!0,html:!0},FORBID_TAGS:["style"]})}function C(e){return DOMPurify.sanitize(e,{USE_PROFILES:{svg:!0},FORBID_TAGS:["style"]})}function I(e,t=Z){let n=e.split(";");const a=[];l.debug(n);for(const e of n){const n=e.split(":"),r=n[0].replace(/\s/,"");l.debug(e,n,r),t.includes(r)&&(l.debug("DETECTED AVAILABLED STYLES"),a.push(e))}const r=a.length?a.join(";"):"";return l.debug(`CLEARED FINAL STRING: ${r}`),r}class E{static Row=new E("row");static Column=new E("column");constructor(e){this.name=e}}class k{constructor(e){this.text=e,this.className="LZTUpSectionTitle"}createElement(){const e=document.createElement("span");return e.classList.add(this.className),e.innerText=this.text,e}}class B extends k{constructor(e){super(e),this.className="LZTUpSectionDesc"}createElement(){const e=document.createElement("span");return e.classList.add(this.className),e.innerHTML=x(this.text),e}}class M{constructor(e,t={}){this.id=e,this.sectionItems=t.sectionItems||[],this.sectionContainers=t.sectionContainers||[],this.direction=t.direction||E.Row,this.hidden=t.hidden??!0}createElement(){const e=document.createElement("div");e.id=this.id,e.classList.add("LZTUpSection",this.direction===E.Row?"row":"column");for(const t of this.sectionItems)e.appendChild(t);return console.log(this),this.hidden&&(console.log(this.id,this.hidden),e.style.display="none"),e}addSectionItem(e,t,n,a,r=(()=>{}),o=!1){const s=document.createElement("div");s.id=a,s.classList.add("LZTUpSectionItem");const i=v(n),c=document.createElement("div");c.classList.add("LZTUpSectionTextContainer");const l=new k(e).createElement(),d=new B(t).createElement();if(c.append(l,d),s.append(i,c),this.direction===E.Column&&o){const e=v("far fa-angle-right gray right");s.append(e)}return s.onclick=async t=>await r(t,e),this.sectionItems.push(s),this}addSectionContainer(e,t){const n=document.createElement("div");n.id=e,n.classList.add("LZTUpSubMenu"),n.style.display="none";for(const e of t)n.appendChild(e);return this.sectionContainers.push(n),this}}class P{constructor(e,t){this.elementId=e,this.content=x(t)}createElement(e,t=(()=>{}),n=(()=>{})){const a=document.createElement("div"),r=document.createElement("input"),o=document.createElement("label");return r.type="checkbox",r.id=this.elementId,r.checked=Boolean(e),o.htmlFor=this.elementId,o.innerHTML=this.content,a.id="LZTUpModalChecksContainer",a.appendChild(r),a.appendChild(o),a.addEventListener("click",(async e=>{e.target.checked?await t():await n()})),a}}const A=class{constructor(e,t="button",n=undefined){this.buttonText=e,this.className=t,this.iconClassName=n}createElement(e=(()=>{})){const t=document.createElement("button");if(t.className=this.className,t.innerText=this.buttonText,this.iconClassName){const e=v(this.iconClassName);e.id="",t.appendChild(e)}return t.onclick=e,t}};function _(e=!0){if(b()){const t=document.querySelector("div.contestThreadBlock"),n=document.querySelector("li.firstPost > div.messageInfo > div.messageContent > article > blockquote.messageText");e?(t.parentElement.append(n),t.style.borderTop="none",t.style.borderBottom="1px solid rgb(45, 45, 45)"):(t.parentElement.prepend(n),t.style.borderTop="1px solid rgb(45, 45, 45)",t.style.borderBottom="none")}}function j(e=!0){if(b())return function(e){const t=document.querySelector(".message.firstPost > .messageInfo > .messageContent > article > blockquote.messageText");if(null!==t)return t.style.display=e?"none":""}(e)}function q(e=!0){b()&&function(e=!0){const t=document.querySelector("div.tagBlock");null!==t&&(t.style.display=e?"none":"")}(e)}function F(e=!0){if(b())return function(e){const t=document.querySelector("div.PollContainer");if(null!==t)return t.style.display=e?"none":""}(e)}function D(){if(b()){const e=document.querySelector(".LztContest--Participate"),t=new A("","button LZTUpRefreshButton","far fa-sync").createElement((e=>{e.preventDefault(),O()}));e.insertAdjacentElement("afterend",t)}}function N(){if(b())return document.querySelector(".captchaBlock > div").childElementCount>0?l.debug("Captcha exists"):O()}function O(){const e=document.querySelector(".captchaBlock > div");if(!e)return l.error("CAPTCHA BLOCK MISSING");turnstile.render(`#${e.id}`,{sitekey:"0x4AAAAAAADMHhlDN2zO9nrC",theme:"dark",size:"compact",callback:function(e){console.log(`Challenge Success ${e}`),$(".Captcha--XenForo_ControllerPublic_Thread").prepend('<input type="hidden" name="cf-turnstile-response" value="'+e+'">');let t=$(".LztContest--Participate");t.length&&(t.attr("href",t.attr("href")+"?cf-turnstile-response="+e),t.removeAttr("disabled").removeClass("disabled"))}})}const z=async()=>{const e=new m,t=await e.read();return[new P("open_ten_contests",'Кнопка "Открыть 10"').createElement(t.openTenContestsBtn,(async()=>{await e.update({openTenContestsBtn:1}),L(10)}),(async()=>{await e.update({openTenContestsBtn:0}),function(e=10){if(y()){const t=$(`#openContestsButton${XenForo.htmlspecialchars(e)}`);t.length&&t.remove()}}(10)})),new P("hide_tags_in_contests","Скрытие тегов в теме розыгрыша").createElement(t.hideTagsInThread,(async()=>{await e.update({hideTagsInThread:1}),q(!0)}),(async()=>{await e.update({hideTagsInThread:0}),q(!1)})),new P("auto_close_on_participate",'Автозакрытие страницы при нажатие на кнопку "Участвовать"\n      <span class="fa fa-exclamation-triangle Tooltip" title="При отключение этой функции страница будет перезагружена"></span>\n      ').createElement(t.autoCloseOnParticipate,(async()=>{await e.update({autoCloseOnParticipate:1}),d(!0)}),(async()=>{await e.update({autoCloseOnParticipate:0}),window.location.reload()})),new P("info_top_in_contests","Отображение информации о розыгрыше вверху темы").createElement(t.infoTopInThread,(async()=>{await e.update({infoTopInThread:1}),_(!0)}),(async()=>{await e.update({infoTopInThread:0}),_(!1)})),new P("remove_content_in_contests","Скрытие содержимого темы розыгрыша").createElement(t.removeContent,(async()=>{await e.update({removeContent:1}),j(!0)}),(async()=>{await e.update({removeContent:0}),j(!1)})),new P("remove_poll_in_contests","Скрытие голосования в теме розыгрыша").createElement(t.removePoll,(async()=>{await e.update({removePoll:1}),F(!0)}),(async()=>{await e.update({removePoll:0}),F(!1)})),new P("update_captcha_button_in_contests",'Кнопка "Обновление капчи"').createElement(t.updateCaptchaButton,(async()=>{await e.update({updateCaptchaButton:1}),D()}),(async()=>{await e.update({updateCaptchaButton:0}),document.querySelector(".LZTUpRefreshButton")?.remove()})),new P("auto_fix_captcha_in_contests",'\n      Автофикс капчи\n      <span class="fa fa-question Tooltip" title="Автоматически обновляет капчу, если она не появилась"></span>\n      <span class="fa fa-exclamation-triangle Tooltip" title="При отключение этой функции страница будет перезагружена"></span>\n    ').createElement(t.autoFixCaptcha,(async()=>{await e.update({autoFixCaptcha:1}),N()}),(async()=>{await e.update({autoFixCaptcha:0}),window.location.reload()}))]},R=class{constructor(e,t,n){this.content=XenForo.htmlspecialchars(e),this.tooltipMessage=t||"",this.messageOnCopy=n||"Успешно скопировано в буфер обмена"}createElement(){const e=document.createElement("span");e.classList.add("copyButton","Tooltip"),e.dataset.phr=this.messageOnCopy,e.title=this.tooltipMessage,e.onclick=new Function("event",`Clipboard.copy('${this.content}', this)`),e.tabIndex=0;const t=v("far fa-clone","");return e.appendChild(t),e}};class H{constructor(e,t,n,a){this.elementId=e,this.label=t,this.content=x(n),this.copyButton=a}createElement(){const e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");var a;if(e.classList.add("clear_fix","profile_info_row"),e.id=this.elementId,t.classList.add("label","fl_l"),n.classList.add("labeled"),t.innerText=this.label+":",a=this.content,("object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName)?n.appendChild(this.content):n.innerHTML=this.content,this.copyButton instanceof R){const e=this.copyButton.createElement();n.appendChild(e)}return e.appendChild(t),e.appendChild(n),e}}const G="LZTUpUserIDRow";function X(e){switch(e){case"profile":if(T()){const e=document.querySelector("#profile_short > .userContentLinks > a:nth-child(1)");return e&&""!==e.href?e.href.endsWith("?tab=mythreads")?X("me"):new URL(e.href).searchParams.get("user_id"):null}case"membercard":if(w()){const e=document.querySelectorAll(c.selectors.memberCard),t=e[e.length-1].querySelector(".memberCardInner > .bottom > .userContentLinks > a:nth-child(1)");return t&&""!==t.href?new URL(t.href).searchParams.get("user_id"):null}case"self":case"me":return XenForo?.visitor?.user_id;default:return null}}function W(e){switch(e){case"self":case"me":return document.querySelector(".accountUsername span")?.innerText;default:return null}}function K(){if(T()&&null===document.querySelector(`#${G}`)){const e=X("profile")??"Не найден",t=document.querySelector("#profile_short > .pairsJustified"),n=new R(e,"Скопировать ID пользователя","ID пользователя успешно скопирован в буфер обмена"),a=new H(G,"ID",e,n).createElement(),r=t.querySelector(".profile_info_row");return r?r.insertAdjacentElement("afterend",a):t.insertAdjacentElement("afterbegin",a)}}function V(){if(w()){const e=document.querySelectorAll(c.selectors.memberCard),t=X("membercard")??"Не найден",n=e[e.length-1].querySelector(`#memberCard${t}.memberCardInner > .bottom > .userContentLinks`),a=document.createElement("div");a.classList.add("title"),a.id="LZTUpUserIDMemberCard",a.innerText=`ID: ${t}`;const r=new R(t,"Скопировать ID пользователя","ID пользователя успешно скопирован в буфер обмена").createElement();a.appendChild(r),n?.insertAdjacentElement("afterbegin",a)}}function J(e=!1){if(T()){const t=document.querySelector(".profile_info_row > .labeled > span.DateTime");if(!t)return;const n=t.getAttribute("title");if(!n)return;if(!e){let e=-2;1===XenForo?.visitor?.language_id&&(e=-3);const a=n.split(" ").slice(0,e).join(" ");return t.innerText=a}return t.innerText=n}}const Q=async()=>{const e=new h,t=await e.read();return[new P("show_userid_in_profile","Показывать ID в профиле пользователя").createElement(t.showUserIdInProfile,(async()=>{await e.update({showUserIdInProfile:1}),K()}),(async()=>{await e.update({showUserIdInProfile:0}),function(){if(T()){const e=document.querySelector(`.profile_info_row#${G}`);e&&e.remove()}}()})),new P("show_userid_in_member_card",'Показывать ID в карточке пользователя\n      <span class="fa fa-exclamation-triangle Tooltip" title="При включение/отключение этой функции страница будет перезагружена"></span>\n      ').createElement(t.showUserIdInMemberCard,(async()=>{await e.update({showUserIdInMemberCard:1}),U("Показывать ID в карточке пользователя включено",5e3),await r(500),window.location.reload()}),(async()=>{await e.update({showUserIdInMemberCard:0}),U("Показывать ID в карточке пользователя выключено",5e3),await r(500),window.location.reload()})),new P("show_fullreg_in_profile","Показывать полную дату регистрации в профиле пользователя").createElement(t.showFullRegInProfile,(async()=>{await e.update({showFullRegInProfile:1}),J(!0)}),(async()=>{await e.update({showFullRegInProfile:0}),J(!1)})),new P("disable_share_typing",'Неписалка в темах\n      <span class="fa fa-exclamation-triangle Tooltip" title="При включение/отключение этой функции страница будет перезагружена"></span>\n      ').createElement(t.disableShareTyping,(async()=>{await e.update({disableShareTyping:1}),U("Неписалка в темах включена",5e3),await r(500),window.location.reload()}),(async()=>{await e.update({disableShareTyping:0}),U("Неписалка в темах выключена",5e3),await r(500),window.location.reload()}))]};class Y{constructor(e){this.content=x(e)}createElement(){const e=document.createElement("div");return e.id="LZTUpModalComment",e.innerHTML=this.content,e}}function ee(e,t,n){return e.setAttribute(t,n)}function te(e,t,n,a=!1){if(!["stroke","fill"].includes(t))return;if(!a)return ee(e,t,n);ee(e,t,n);const r=e.querySelectorAll("*");for(const e of r)ee(e,t,n)}class ne{constructor(e,t=!1){this.previewId="LZTUpPreviewBadge",this.customBadgeId="LZTUpUserBadge",this.badgeQuery=t?`#${this.previewId}`:`#${this.customBadgeId}`,this.badges=e,this.isPreview=t}createElement(){const e=document.createElement("div");e.classList.add("avatarUserBadges");for(let t=0;t<this.badges.length;t++){const n=document.createElement("span");n.classList.add("avatarUserBadge","Tooltip"),n.tabIndex=0,n.title=XenForo.htmlspecialchars(this.badges[t].text),this.isPreview?n.id=this.previewId:n.id=this.customBadgeId,this.badges.length>1&&n.classList.add(`avatarUserBadge--${t+1}`),n.dataset.position=t+1,this.badges.length>1&&(n.dataset.multiple=!0),e.appendChild(n)}return e}findBadgeElement(e,t){return document.querySelector(e+`[data-position="${t}"]`)}findAllBadgeElement(e,t){return document.querySelectorAll(e+`[data-position="${t}"]`)}applyBadge(e,t){return t?.length>1&&t?.startsWith(".")?(t=t.replace(".",""),e.classList.add("userBanner",t)):t.startsWith("<svg")&&t.endsWith("svg>")?(e.innerHTML=C(t),e.classList.add("badgeDefaultBackground")):e.classList.add("uniq_default","badgeDefaultBackground")}updateIcon(e,t){if(e)return function(e){if(e)e.className="",e.style=""}(e),e.classList.add("avatarUserBadge","Tooltip"),"true"===e.dataset.multiple&&e.classList.add(`avatarUserBadge--${t.position}`),this.applyBadge(e,t.svg)}updateText(e,t){var n,a;if(e)return e._tippy?(n=e,a=XenForo.htmlspecialchars(t.text),n.setAttribute("title",""),n.setAttribute("data-cachedtitle",a),n._tippy.setContent(a)):XenForo.Tooltip($(e))}updateColor(e,t){if(!e)return;const n=e.querySelector("svg");n&&(te(n,"stroke",t.strokeColor,!0),te(n,"fill",t.fillColor,!0))}updateStyle(e,t){if(e&&t.style&&!t.style?.startsWith("."))return e.style=t.style}updateBadge(e){const t=this.findAllBadgeElement(this.badgeQuery,e.position);if(t.length)for(const n of t)this.updateIcon(n,e),this.updateText(n,e),this.updateColor(n,e),this.updateStyle(n,e)}updateBadges(){l.debug("updateBadges");for(const e of this.badges)"object"==typeof e?(l.debug(e),this.updateBadge(e)):l.error("Invalid badge in array")}}class ae{constructor(e){this.cachePrefix="lztup-",this.name=e,this.fullName=`${this.cachePrefix}${this.name}`}async get(){return await GM_getValue(this.fullName)}async set(e){return await GM_setValue(this.fullName,e)}async remove(){return await GM_deleteValue(this.fullName)}async list(){return await GM_listValues(this.fullName)}async clearAll(){for(const e of await this.list())await new ae(e).remove()}}const re=ae;class oe{constructor(e,t,n,a=null){this.userid=e,this.username=t,this.data=n,this.profileElId=a||"LZTUpPreviewContainer",this.badges=new ne(n.badgeIcons,!0)}createElement(){const e=document.createElement("div");e.id=this.profileElId,e.classList.add("previewContainer");const t=this.badges.createElement(),n=document.createElement("div");n.classList.add("avatarBox"),n.appendChild(t),n.innerHTML+=`\n      <a href="members/${encodeURIComponent(this.userid)}/" class="avatar Av${XenForo.htmlspecialchars(this.userid)}m" data-avatarhtml="true">\n        <span class="img m" style="background-image: url(${function(e){if(e===X("me"))return document.querySelector("img.navTab--visitorAvatar").src;const t=document.querySelectorAll("a.avatar");return Array.from(t).find((t=>t.classList?.contains(`Av${e}s`)||t.classList?.contains(`Av${e}m`)))?t.src:null}(this.userid)})"></span>\n      </a>\n    `;const a=document.createElement("div");return a.classList.add("info"),a.innerHTML=`\n      <span id="LZTUpUsernameStyle" class="UsernameStyle bold">${XenForo.htmlspecialchars(this.username)}</span>\n      <div class="bannerOrStatus">\n        <em id="LZTUpUserBannerStyle" class="UserBannerStyle userBanner"></em>\n      </div>\n    `,e.appendChild(n),e.appendChild(a),e}clearStyle(e){const t=document.querySelector(e);if(t)return t.className="",t.style="",t}async updateUsernameStyle(e){const t=this.clearStyle(`#${this.profileElId} #LZTUpUsernameStyle`);t&&(""===e&&(e=`.${await new re("user-group").get()}`),t.classList.add("UsernameStyle","bold"),s(t,e))}updateBannerStyle(e){const t=this.clearStyle(`#${this.profileElId} #LZTUpUserBannerStyle`);t&&(t.classList.add("UserBannerStyle","userBanner"),s(t,e))}updateBannerText(e){const t=document.querySelector(`#${this.profileElId} #LZTUpUserBannerStyle`);t&&(t.innerText=XenForo.htmlspecialchars(e))}updateBanner(e){const t=this.clearStyle(`#${this.profileElId} #LZTUpUserBannerStyle`);if(t){if(!e.bannerStyle||!e.bannerText)return t.style.display="none";t.style.display="",this.updateBannerStyle(e.bannerStyle),this.updateBannerText(e.bannerText)}else l.error("Failed to get element by userBanner in PreviewProfile!")}updateBackground(e){const t=document.querySelector(`#${this.profileElId}`);console.log(`#${this.profileElId}`,t),t?(e.length&&(console.log("add imageURL"),e=`linear-gradient(rgba(54, 54, 54, 0.85), rgba(54, 54, 54, 0.85)), url(${e})`),t.style.backgroundImage=e):l.error("Failed to get previewContainer in PreviewProfile!")}updateBadges(){return this.badges.updateBadges()}async updateAll(){await this.updateUsernameStyle(this.data.usernameStyle),this.updateBanner(this.data),this.updateBackground(this.data.backgroundImage),this.badges.badges=this.data.badgeIcons,this.updateBadges()}}class se{constructor(e="",t="",n=0,a=0){this.text=e,this.placeholder=t,this.minLength=n,this.maxLength=a}createElement(e){const t=document.createElement("textarea");return t.classList.add("LZTUpTextArea","textCtrl"),t.innerText=this.text,t.placeholder=this.placeholder,t.minLength=this.minLength,this.maxLength>0&&(t.maxLength=this.maxLength),t.onkeyup=e,t.onchange=e,t}}class ie{constructor(e="",t="",n=0,a=0){this.text=e,this.placeholder=t,this.minLength=n,this.maxLength=a}createElement(e){const t=document.createElement("input");return t.classList.add("textCtrl"),t.value=this.text,t.placeholder=this.placeholder,t.minLength=this.minLength,this.maxLength>0&&(t.maxLength=this.maxLength),t.onkeyup=e,t.onchange=e,t}}class ce{constructor(e){this.text=e}createElement(){const e=document.createElement("p");return e.classList.add("LZTUpModalDescription","muted"),e.innerText=this.text,e}}class le{constructor(e,t,n=""){this.id=e,this.value=t,this.description=n}createElement(e){const t=document.createElement("div");t.classList.add("LZTUpColorPickerWrap");const n=document.createElement("input");if(n.id=this.id,n.classList.add("LZTUpColorPicker"),n.value=this.value,n.type="text",n.dataset.coloris="",n.oninput=e,""!==this.description){const e=new ce(this.description).createElement();t.appendChild(e)}return t.appendChild(n),t}}class de{constructor(e){this.text=e}createElement(){const e=document.createElement("h2");return e.classList.add("LZTUpModalHeading"),e.innerText=this.text,e}}class ue{constructor(e,t="",n=""){this.elements=e,this.heading=t,this.description=n}createElement(){const e=document.createElement("div");if(e.classList.add("LZTUpContainer"),this.heading){const t=new de(this.heading).createElement();e.appendChild(t)}if(this.description){const t=new ce(this.description).createElement();e.appendChild(t)}for(const t of this.elements)e.appendChild(t);return e}}class pe{constructor(e=""){this.customStyle=e}createElement(){const e=document.createElement("div");return e.classList.add("LZTUpModalSeparator"),""!==this.customStyle&&(e.style.borderBottom=this.customStyle),e}}class me{constructor(e){this.elements=e}createElement(e=(e=>{})){const t=document.createElement("div");t.classList.add("LZTUpSortableContainer");for(const e of this.elements)t.appendChild(e);return Sortable.create(t,{handle:".LZTUpSortableDraggable",animation:150,onMove:e}),t}}class he{constructor(e,t=null){this.content=e,this.dataId=t}createElement(e=(()=>{}),t=(()=>{})){const n=document.createElement("div");n.classList.add("LZTUpSortableItem"),this.dataId&&(n.dataset.id=this.dataId);const a=document.createElement("div");a.classList.add("LZTUpSortableDraggable");const r=v("far fa-grip-vertical","");a.appendChild(r);const o=document.createElement("div");o.classList.add("LZTUpSortableContent"),o.innerHTML=`\n      <p>${this.content}</p>\n    `;const s=document.createElement("div");s.classList.add("LZTUpSortableUtility");const i=document.createElement("div");i.classList.add("LZTUpSortableEditButton");const c=v("far fa-edit","");i.appendChild(c),i.onclick=async t=>{console.log("Edit button clicked"),await e(t,n)};const l=document.createElement("div");l.classList.add("LZTUpSortableRemoveButton");const d=v("far fa-trash","");return l.appendChild(d),l.onclick=async e=>{confirm("Вы точно хотите удалить иконку?")&&(n.remove(),await t(e,n))},s.appendChild(i),s.appendChild(l),n.appendChild(a),n.appendChild(o),n.appendChild(s),n}}function ge(e){const t=document.querySelector(".xenOverlay > .errorOverlay#LZTUpModalOverlay").querySelector("h2.heading");t.id="LZTUpModalMainTitle",t.innerText=e}function fe(e="",t=i.extName,n=null,a=(()=>{})){const r="button.LZTUpModalBackButton";return null!==document.querySelector(r)&&document.querySelector(r).remove(),function(o){const s=document.querySelector(".xenOverlay > .errorOverlay#LZTUpModalOverlay"),i=new A("","LZTUpModalBackButton","fas fa-long-arrow-left").createElement();i.onclick=()=>{document.querySelectorAll("div.LZTUpSubMenu").forEach((e=>e.style.display="none")),(()=>{if(document.querySelector(r).remove(),ge(t),"tempmenu"===e)document.querySelector(c.uiElementsSelectors.lztupTempSubMenu).style.display="none",n.style.display="",fe(),a();else{document.querySelector(".LZTUpModalContent > .LZTUpSection").style.display="";const e=document.querySelector(".LZTUpTabs");e.style.display="";const t=e.querySelectorAll("#LZTUpTab");t.forEach((e=>e.classList.remove("active"))),t[0].classList.add("active"),a()}})()},s.insertAdjacentElement("afterbegin",i)}()}function be(e,t){return document.querySelector(".LZTUpTabs").style.display="none",document.querySelectorAll(".LZTUpSubMenu").forEach((e=>e.style.display="none")),document.querySelectorAll(".LZTUpModalContent > .LZTUpSection").forEach((e=>e.style.display="none")),document.querySelector(`#${e}`).style.display="",ge(t),fe()}const ye=c.uiElementsId.lztupTempSubMenu,Te=c.uiElementsSelectors.lztupTempSubMenu,we={theme:"lzt",themeMode:"dark",formatToggle:!0,closeButton:!0,clearButton:!0,alpha:!0,swatches:[]};function Le(e=".xenOverlay"){const t=document.querySelectorAll(".LZTUpColorPicker");for(const n of t){if(!document.querySelector(".clr-picker"))try{Coloris.init(e)}catch(e){console.error(e)}try{Coloris(Object.assign(we,{el:`#${n.id}`,parent:e}))}catch(e){console.error(e)}}}class Ue{constructor(e,t){this.elementId=e,this.label=t}createElement(){const e=document.createElement("em");e.id=this.elementId,e.classList.add("userBanner","wrapped"),e.itemprop="title";const t=document.createElement("div");t.className="before",e.appendChild(t);const n=document.createElement("strong");return n.innerText=XenForo.htmlspecialchars(this.label),e.appendChild(n),t.className="after",e.appendChild(t),e}}function Se(e){const t=W("me"),n=document.querySelectorAll(".username span").values().filter((e=>e.innerText===t));for(const t of n)t.className="",t.style="",s(t,e)}function ve(e,t){if(T()&&X("profile")===X("me")){const n=document.querySelector("em.userBanner#LZTUpCustomBanner");if(n)return n.className="userBanner wrapped",n.style="",n.innerText=t,s(n,e);const a=document.querySelector(".avatarScaler");if(!a)return;const r=new Ue("LZTUpCustomBanner",t).createElement();return s(r,e),a.insertAdjacentElement("afterend",r)}}function Ze(e){const t=X("me"),n=new ne(e,!1),a=[...document.querySelectorAll(`.avatar.Av${t}m`),...document.querySelectorAll(`.avatar.Av${t}s`)].filter((e=>void 0!==e)).filter((e=>e.parentElement?.classList.contains("avatarHolder")));console.log(a);for(const e of a){console.log(e);const t=e.parentElement,a=n.createElement();console.log(t),t.querySelector(".avatarUserBadges")?.remove(),console.log(a),t.prepend(a),n.updateBadges()}}const xe="LZTUpCustomBackground";function Ce(e,t=!1){if(!t&&T()&&X("profile")!==X("me"))return!1;const n=document.querySelector("body");if(!e)return n.id="",void(n.style.backgroundImage="");n.id=xe,n.style.backgroundImage=`linear-gradient(rgba(54, 54, 54, 0.85), rgba(54, 54, 54, 0.85)), url(${e})`}function Ie(e){if(T())return Ce(e)}const Ee=new g;async function ke(e,t,n){const a=Number(t.dataset.id),r=document.querySelector(".LZTUpModalContent"),o=document.querySelector("#LZTUpUniqContainer"),s=await Ee.read(),i=s.badgeIcons.filter((e=>e.position===a));let c=i[0];console.log(a,"==>",s.badgeIcons,"==>",i,"==>",c);const l=Be(s,"LZTUpTempPreviewContainer");async function d(e){let t=(await Ee.read()).badgeIcons;const n=t.find((e=>e.position===a)),r=t.indexOf(n);return t[r]=e,t}const u=function(e){const t=document.querySelector(Te);t&&t.remove();const n=document.createElement("div");n.id=ye,n.classList.add("LZTUpSubMenu");for(const t of e)n.appendChild(t);return n.style.display="none",n}([l.createElement(),new ue([new se(c.svg,"<svg>...</svg>",0,3e3).createElement((async e=>{let t=C(e.target.value.trim());if(t.length>3e3)return U("Максимальная длина иконки 3000 символов. Уменьшите введенный текст для сохранения.");c.svg=t,l.badges.badges=await d(c),l.updateBadges()}))],"Иконка на аватарке","Максимум 3000 символов.").createElement(),new ue([new se(c.style,"background: #fff",0,1500).createElement((async e=>{let t=I(e.target.value.trim());if(t.length>1500)return U("Максимальная длина стиля иконки 1500 символов. Уменьшите введенный текст для сохранения.");t.length>1&&t.startsWith(".")&&(e.target.value=t.replace(/\s/g,""),t=e.target.value),c.style=t,l.badges.badges=await d(c),l.updateBadges()}))],"Стиль иконки","Максимум 1500 символов.").createElement(),new ue([new ie(c.text,"Идут два сталкера",0,24).createElement((async e=>{let t=e.target.value;if(t.length>24)return U("Максимальная длина текста в лычке 24 символа. Уменьшите введенный текст для сохранения.");c.text=t,l.badges.badges=await d(c),l.updateBadges()}))],"Текст при наведение на иконку","Максимум 24 символа.").createElement(),new ue([new le("LZTUpColorPickerFill",c.fillColor,"Цвет иконки (fill):").createElement((async e=>{let t=e.target.value;c.fillColor=t,l.badges.badges=await d(c),l.updateBadges()})),new le("LZTUpColorPickerStroke",c.strokeColor,"Цвет иконки (stroke):").createElement((async e=>{let t=e.target.value;c.strokeColor=t,l.badges.badges=await d(c),l.updateBadges()}))],"Изменение цвета иконки").createElement(),new ue([new A("Сохранить","button primary LZTUpIconButton fit","far fa-save").createElement((async()=>{U("Иконка успешно сохранена.");const e=await d(c);await Ee.update({badgeIcons:e}),Ze(e),l.badges.badges=e,l.updateBadges()}))]).createElement()]);var p,m;r.appendChild(u),Le(),p=o,m=async()=>{const e=document.querySelectorAll(".LZTUpSortableContainer > .LZTUpSortableItem"),t=await Ee.read();for(let n=0;n<t.badgeIcons.length;n++)e[n].querySelector(".LZTUpSortableContent").innerHTML=x(t.badgeIcons[n].text);n.badges.badges=t.badgeIcons,n.updateBadges()},document.querySelectorAll(".LZTUpSubMenu").forEach((e=>e.style.display="none")),document.querySelector(Te).style.display="",ge("Управление иконкой"),fe("tempmenu","Локальный Уник",p,m),await l.updateAll(s)}function Be(e,t=null){const n=X("me"),a=W("me");return new oe(n,a,e,t)}const Me=async()=>{async function e(e,t="LZTUpPreviewContainer"){const n=document.querySelector(`#${t} > .avatarBox > .avatarUserBadges`);if(n){for(const e of n.children)e.remove();const t=new ne(e.badgeIcons,!0).createElement();n.innerHTML=t.innerHTML,o.data=e,await o.updateAll()}}async function t(e,t){const n=await Ee.read();let a=n.badgeIcons,r=[];const s=document.querySelector(`#LZTUpPreviewBadge[data-position="${t.dataset.id}"]`);s&&s.remove();const i=document.querySelector("#LZTUpPreviewBadge");i&&(i.dataset.position=1,i.dataset.multiple="false",i?.classList.contains("avatarUserBadge--1")&&i.classList.remove("avatarUserBadge--1"),i?.classList.contains("avatarUserBadge--2")&&i.classList.remove("avatarUserBadge--2"));for(const e of a){if(String(e.position)===t.dataset.id)continue;const n=document.querySelector(".LZTUpSortableContainer > .LZTUpSortableItem");n&&(n.dataset.id=1),e.position=1,r.push(e)}await Ee.update({badgeIcons:r}),o.data=n,await o.updateAll(),Ze(r)}const n=await Ee.read(),a=await new re("user-group").get(),r=window.location.hostname,o=Be(n);return[new Y(`На этой вкладке вы можете выбрать стиль вашего ника и лычки. Этот стиль виден только вам.\n      Чтобы уник был виден всем, рекомендуем <a href="https://${r}/account/upgrades?upgrade_id=14" target="_blank">купить</a> настоящий уник.`).createElement(),o.createElement(),new ue([new se(n.usernameStyle,"color: #0daf77",0,1500).createElement((e=>{let t=e.target.value.trim();if(t.length>1500)return U("Максимальная длина стиля ника 1500 символов. Уменьшите введенный текст для сохранения.");t.length>1&&t.startsWith(".")?(e.target.value=t.replace(/\s/g,""),t=e.target.value):t=I(t),o.updateUsernameStyle(t),n.usernameStyle=t}))],"Стиль ника","Максимум 1500 символов. При отсутствии кода используется цвет вашей группы с форума.").createElement(),new ue([new se(n.bannerStyle,"background: #fff",0,1500).createElement((e=>{let t=e.target.value.trim();if(t.length>1500)return U("Максимальная длина стиля лычки 1500 символов. Уменьшите введенный текст для сохранения.");t.length>1&&t.startsWith(".")?(e.target.value=t.replace(/\s/g,""),t=e.target.value):t=I(t),n.bannerStyle=t,o.updateBanner(n)}))],"Стиль лычки","Максимум 1500 символов. При отсутствии текста или стиля лычка отключается.").createElement(),new ue([new ie(n.bannerText,"Внимание анекдот",0,24).createElement((e=>{let t=e.target.value;if(t.length>24)return U("Максимальная длина текста в лычке 24 символа. Уменьшите введенный текст для сохранения.");n.bannerText=t,o.updateBanner(n)}))],"Текст в лычке","Максимум 24 символа. При отсутствии текста или стиля лычка отключается.").createElement(),(new pe).createElement(),new ue([new me(function(e,n){console.log("Generating badge items");const a=[];for(const r of n.badgeIcons.sort(((e,t)=>e.position-t.position)))console.log(r.text,r.position),a.push(new he(r.text,r.position).createElement(((t,n)=>ke(0,n,e)),t));return console.log(a),a}(o,n)).createElement((async t=>{const a=t.target.children,r=await Ee.read();r.badgeIcons.reverse();for(let e=0;e<a.length;e++)l.debug("moving items"),a[e].dataset.id=e+1,r.badgeIcons[e].position=e+1;n.badgeIcons=r.badgeIcons,await Ee.update({badgeIcons:r.badgeIcons}),await e(n),Ze(r.badgeIcons)})),new A("Добавить иконку","button LZTUpIconButton","far fa-plus").createElement((async a=>{const r=a.target.parentElement?.querySelector(".LZTUpSortableContainer");if(!r)return U("Не найден контейнер для добавления!");if(2===r.children.length)return U("Вы не можете добавить больше 2 иконок!");const s=(await Ee.read()).badgeIcons,i={position:r.children.length+1,style:"",text:"Новая иконка",svg:"",fillColor:"",StrokeColor:""};s.push(i);const c=new he(i.text,i.position).createElement(((e,t)=>ke(0,t,o)),t);r.appendChild(c),await Ee.update({badgeIcons:s}),n.badgeIcons=s,await e(n),Ze(s)}))],"Управление иконками","Ниже вы можете легко настроить иконки уника и их порядок (изменения автоматически применяются)").createElement(),(new pe).createElement(),new ue([new ie(n.backgroundImage,"Ссылка на изображение",0,2048).createElement((e=>{let t=XenForo.htmlspecialchars(e.target.value);if(t.length>2048)return U("Максимальная длина ссылки на фон 2048 символов. Введите другую ссылку для сохранения.");console.log("execute background"),n.backgroundImage=t,o.updateBackground(n.backgroundImage)}))],"Фон профиля","Поддерживаются только прямые ссылки на изображения.").createElement(),new P("profile_background_everywhere","Заменить фон на всех страницах форума").createElement(n.backgroundImageEverywhere,(async()=>{await Ee.update({backgroundImageEverywhere:1}),Ce(n.backgroundImage)}),(async()=>{await Ee.update({backgroundImageEverywhere:0}),Ce(""),Ie(n.backgroundImage)})),new ue([new A("Сохранить","button primary LZTUpIconButton fit","far fa-save").createElement((async()=>{const e=await Ee.read();await Ee.update({usernameStyle:n.usernameStyle,bannerStyle:n.bannerStyle,bannerText:n.bannerText,backgroundImage:n.backgroundImage}),U("Настройки локального уника успешно сохранены."),n.usernameStyle?Se(n.usernameStyle):""!==e.usernameStyle&&""==n.usernameStyle&&Se(`.${a}`),n.bannerStyle&&n.bannerText&&ve(n.bannerStyle,n.bannerText),n.backgroundImage&&(n.backgroundImageEverywhere?Ce(n.backgroundImage):Ie(n.backgroundImage)),o.data=n,await o.updateAll()}))]).createElement()]},Pe=async()=>{const e=new M("LZTUpInfoSection",{direction:E.Column,hidden:!1});for(const t of c.infoLinks)e.addSectionItem(t.title,t.desc,t.icon,t.sectionId,(()=>window.open(t.href)));return[e.createElement()]},Ae=new p,_e=new m,$e=new g,je=new f,qe=new h;async function Fe(){const e=await Ae.read(),t=await _e.read(),n=await $e.read(),a=await je.read(),r=await qe.read();!function(e,t){const n=new Blob([e],{type:"application/json"}),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download="LZTUpgradeConfig.json",a.click()}(JSON.stringify({appear:e,contests:t,profile:n,settings:a,users:r})),U("Файл настроек выгружен",5e3)}async function De(){const e=await async function(){const e=document.createElement("input");e.type="file",e.accept="application/json",e.click();const t=await new Promise((t=>{e.onchange=()=>{t(e.files[0])}})),n=new FileReader;return n.readAsText(t),await new Promise((e=>{n.onload=()=>{e(n.result)},n.onerror=t=>{l.error("Ошибка загрузки файла настроек",t),e(!1)}}))}();if(e)try{const t=JSON.parse(e);await Ae.update(t?.appear),await _e.update(t?.contests),await $e.update(t?.profile),await je.update(t?.settings),await qe.update(t?.users),U("Настройки загружены. Выполняю перезагрузку страницы...",5e3),await r(500),window.location.reload()}catch(e){l.error("Ошибка загрузки файла настроек",e),U("Ошибка загрузки файла настроек",5e3)}else U("Ошибка загрузки файла настроек",5e3)}async function Ne(){await(new re).clearAll(),U("Кеш успешно очищен",5e3),await r(1e3),window.location.reload()}const Oe=async()=>[new M("LZTUpInfoSection",{direction:E.Column,hidden:!1}).addSectionItem("Сохранить настройки в файл","","far fa-file-download","LZTUpSaveSettingsItem",Fe).addSectionItem("Загрузить настройки из файла","","far fa-upload","LZTUpUploadSettingsItem",De).addSectionItem("Очистить кеш","","far fa-database","LZTUpClearCacheItem",Ne).createElement()];var ze=n("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Re=n.n(ze),He=n("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),Ge=n.n(He),Xe=n("./node_modules/style-loader/dist/runtime/insertBySelector.js"),We=n.n(Xe),Ke=n("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),Ve=n.n(Ke),Je=n("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),Qe=n.n(Je),Ye=n("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),et=n.n(Ye),tt=n("./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/styles/menu.scss"),nt={};nt.styleTagTransform=et(),nt.setAttributes=Ve(),nt.insert=We().bind(null,"html"),nt.domAPI=Ge(),nt.insertStyleElement=Qe(),Re()(tt.Z,nt),tt.Z&&tt.Z.locals&&tt.Z.locals;class at{constructor(e,t,n,a){this.name=e,this.className=t,this.sectionClassName=n,this.active=a}createElement(){const e=document.createElement("li");e.id="LZTUpTab",e.className=this.className;const t=document.createElement("span");return t.innerText=this.name,e.appendChild(t),e.addEventListener("click",(()=>this.setActive())),e}setActive(){document.querySelectorAll("#LZTUpTab").forEach((e=>e.classList.remove("active"))),document.querySelector(`.${this.className}`).classList.add("active"),document.querySelectorAll(".LZTUpModalContent > .LZTUpSection").forEach((e=>e.style.display="none")),document.querySelector(`#${this.sectionClassName}`).style.display=""}}var rt=n("./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/styles/buttons.scss"),ot={};ot.styleTagTransform=et(),ot.setAttributes=Ve(),ot.insert=We().bind(null,"html"),ot.domAPI=Ge(),ot.insertStyleElement=Qe(),Re()(rt.Z,ot),rt.Z&&rt.Z.locals&&rt.Z.locals;const st=document.createElement("li"),it=document.createElement("a");it.id="LZTUpButton",it.innerText=i.extName,st.appendChild(it),st.onclick=async function(){const e=[new at("Главная","LZTUpMainTab","LZTUpMainSection",!0),new at("Настройки","LZTUpSettingsTab","LZTUpSettingsSection",!1)],t=await async function(e){const t=document.createElement("div");t.innerText="Страница Внешнего вида";const n=[t],a=document.createElement("div");a.innerText="Страница обновлений";const r=[a],o=[new M("LZTUpMainSection").addSectionItem("Локальный Уник","Максимальная кастомизация","far fa-palette","LZTUpUniqItem",((e,t)=>be("LZTUpUniqContainer",t))).addSectionItem("Розыгрыши","Комфорт для розыгрышей","far fa-gift","LZTUpContestsItem",((e,t)=>be("LZTUpContestsContainer",t))).addSectionItem("Пользователи","Штучки для пользователей","far fa-user","LZTUpUsersItem",((e,t)=>be("LZTUpUsersContainer",t))).addSectionItem("Внешний вид","Темы, логотипы и другое","far fa-drafting-compass","LZTUpAppearItem",((e,t)=>be("LZTUpAppearContainer",t))).addSectionContainer("LZTUpUniqContainer",await Me()).addSectionContainer("LZTUpContestsContainer",await z()).addSectionContainer("LZTUpUsersContainer",await Q()).addSectionContainer("LZTUpAppearContainer",n),new M("LZTUpSettingsSection").addSectionItem("Настройки","Настройки расширения","far fa-cog","LZTUpSettingsItem",((e,t)=>be("LZTUpSettingsContainer",t))).addSectionItem("Обновления","Установка и проверка обновлений расширения","far fa-cloud-download","LZTUpUpdateItem",((e,t)=>be("LZTUpUpdateContainer",t))).addSectionItem("Информация",`Версия: ${GM_info?.script?.version}`,"far fa-info-circle","LZTUpInformationItem",((e,t)=>be("LZTUpInformationContainer",t))).addSectionContainer("LZTUpSettingsContainer",await Oe()).addSectionContainer("LZTUpUpdateContainer",r).addSectionContainer("LZTUpInformationContainer",await Pe())],s=document.createElement("div");s.classList.add("LZTUpModalContent");const i=document.createElement("ul");i.classList.add("LZTUpTabs"),s.appendChild(i);for(const e of o){const t=e.createElement();s.appendChild(t);for(const t of e.sectionContainers)s.append(t),t.querySelectorAll(".Tooltip").forEach((e=>XenForo.Tooltip($(e))))}l.debug("Generated menu tabs: ",e);for(const t of e)s.querySelector(".LZTUpTabs").appendChild(t.createElement());return s}(e),n=(function(e,t=""){XenForo.alert(t,e,null,(e=>{document.querySelector("div.modal.fade").remove()}))}(i.extName,'<div id="LZTUpModalBase"></div>'),document.querySelector("#LZTUpModalBase"));n.appendChild(t);for(const t of e)t.active&&t.setActive();const a=n.parentElement;a.style.whiteSpace="unset",a.parentElement.id="LZTUpModalOverlay",a.parentElement.style="margin-bottom: 15px;",ge(i.extName),function(){let e=$("#LZTUpTooltip.Tooltip");XenForo.Tooltip(e)}(),Le();const r=new g,o=await r.read(),s=X("me"),c=W("me"),d=new oe(s,c,o);await d.updateAll()};const ct=st,lt=class{constructor(e,t="#",n="button"){this.buttonContent=e,this.buttonHref=t,this.className=n}createElement(){const e=document.createElement("a");return e.href=this.buttonHref,e.className=this.className,e.innerHTML=this.buttonContent,e}};var dt=n("./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/styles/errorPage.scss"),ut={};ut.styleTagTransform=et(),ut.setAttributes=Ve(),ut.insert=We().bind(null,"html"),ut.domAPI=Ge(),ut.insertStyleElement=Qe(),Re()(dt.Z,ut),dt.Z&&dt.Z.locals&&dt.Z.locals;var pt=n("./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/styles/universal.scss"),mt={};mt.styleTagTransform=et(),mt.setAttributes=Ve(),mt.insert=We().bind(null,"html"),mt.domAPI=Ge(),mt.insertStyleElement=Qe(),Re()(pt.Z,mt),pt.Z&&pt.Z.locals&&pt.Z.locals,async function(){new f,GM_info?.script?.version&&l.log(`${i.extName} version: ${GM_info?.script?.version}`);const n=new p;await n.init();const s=await n.read();let u=await new re("theme-name").get();var b;l.debug(`Founded cached theme ${u}`),!u&&s?.theme>0&&(l.debug(`Requesting theme with id ${s.theme}...`),u=await(b=s.theme,new Promise((async(t,n)=>{console.log("Loading theme start... "+new Date),l.debug(`onExtensionStart: Start loading theme with id ${b}`);const a=await async function(){return await async function(e,t){try{return await $.ajax({url:e,dataType:"json"})}catch(e){return l.log(t),!1}}(e.RC,`Не удалось получить список тем (${e.RC})`)}();if(a?.length){l.debug("onExtensionStart: Themes arrray getted: ",a);const e=a.find((e=>e.uid===b&&1===e.active));return t(e?.file)}l.debug("onExtensionStart: Not finded active theme"),n(!1)}))).catch((e=>console.error(e))),await new re("theme-name").set(u)),l.debug("Loading theme... "+new Date),function(t){const n=document.createElement("link");n.href=`${e.I1}/${t}.css`,n.type="text/css",n.rel="stylesheet",a("head",3e3).then((()=>{document.querySelector("head").appendChild(n)}))}(u),l.debug("Loading finished... "+new Date);const y=await a("body",12e4);var T;if(y){if(y.length){if(/^(Error\s[0-9]{3}|Site\sMaintenance)$/.test(document.head.querySelector("title").innerText)){if(!s||0===s?.newErrorPage)return;document.body.classList.add("LZTUpErrorPage");const e=document.body.querySelector("article > div"),t=document.createElement("img");if(t.src="https://i.imgur.com/iVmKDr7.gif",t.alt="Duck rain",e.appendChild(t),0===s?.selfAdOnNewErrorPage)return;const n=document.createElement("div");n.classList.add("LZTUpErrorPageSelfAd");const a=document.createElement("p");a.innerText="Пока форум недоступен, рекомендуем ознакомиться с нашими соц. сетями",a.classList.add("selfAd");const r=document.createElement("div");r.classList.add("buttons");const o=new lt('\n          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">\n            <path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"/>\n          </svg>\n          Telegram\n        ',c.links.telegramChannel).createElement(),i=new lt('\n          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">\n            <path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/>\n          </svg>\n          Github\n        ',c.links.githubPage).createElement();return r.appendChild(o),r.appendChild(i),n.appendChild(a),n.appendChild(r),void e.appendChild(n)}await async function(e=15e3){const t=Date.now();for(;Date.now()-t<e;){const n=XenForo._csrfToken;if(n&&n.length||Date.now()-t>e)return n;await new Promise((e=>setTimeout(e,1e3)))}return null}(12e4);const e=W("me"),n=X("me"),a=document.querySelector(".accountUsername.username span").className,i=$("img.navTab--visitorAvatar").attr("src");l.debug("┏━━━━━━━━ DEBUG INFO ━━━━━━━━━━┓"),l.debug(`Script version: ${GM_info?.script?.version}`),l.debug(`Account username: ${e}`),l.debug(`Account userid: ${n}`),l.debug(`Account userGroup: ${a}`),l.debug(`Account userAvatar: ${i}`),l.debug("┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┚"),T=ct,document.querySelector("#AccountMenu > ul:nth-child(1) > li:nth-child(10)").insertAdjacentElement("afterend",T),await new re("user-group").set(a);const u=new m;await u.init();const p=await u.read(),f=new h;await f.init();const b=await f.read(),y=new g;await y.init();const w=await y.read();w&&((w.usernameStyle||w.badgeIcons.length)&&(w.usernameStyle&&Se(w.usernameStyle),w.badgeIcons.length&&Ze(w.badgeIcons),S((async e=>{if(l.debug(e),e.target.classList.contains("messageList")||e.target.classList.contains("messageSimpleList")||e.target.classList.contains("messageResponse")||e.target.classList.contains("CommentPostList")||e.target.classList.contains("discussionList")||e.target.classList.contains("chat2-messages")||e.target.classList.contains("fe-ac-user")||e.target.classList.contains("latestThreads")||e.target.parentElement?.classList.contains("conversationMessages")||e.nextSibling?.classList?.contains("modal")||e.previousSibling?.classList?.contains("Alert")||e.previousSibling?.nextSibling?.classList?.contains("Alert")||"AlertsDestinationWrapper"===e.target.id||"StackAlerts"===e.target.id){const e=await y.read();e.usernameStyle&&Se(e.usernameStyle),e.badgeIcons.length&&Ze(e.badgeIcons)}}))),w.bannerStyle&&w.bannerText&&ve(w.bannerStyle,w.bannerText),w.backgroundImage&&(w.backgroundImageEverywhere?Ce(w.backgroundImage):Ie(w.backgroundImage))),p&&(1===p.openTenContestsBtn&&L(10),function(e,n){const a=$(`li.node${e}.forum.level-n`);$(a).on("click",(async()=>{await r(750),await t("div.pageNavLinkGroup")&&n()}))}(c.nodes.contests,(async()=>{const e=new m;1===(await e.read()).openTenContestsBtn&&L(10)})),1===p.hideTagsInThread&&q(!0),1===p.autoCloseOnParticipate&&d(!0),1===p.infoTopInThread&&_(!0),1===p.removeContent&&j(!0),1===p.removePoll&&F(!0),1===p.updateCaptchaButton&&D(),1===p.autoFixCaptcha&&N()),b&&(1===b.showUserIdInProfile&&K(),1===b.showUserIdInMemberCard&&(V(),S((e=>{e.nextSibling&&e.nextSibling?.classList?.contains("modal")&&V()}))),1===b.showFullRegInProfile&&J(!0),1===b.disableShareTyping&&o(XenForo,"threadNotify")&&o(XenForo.threadNotify,"shareTypingActivity")&&(l.debug("bypassShareTyping thread: true"),XenForo.threadNotify.shareTypingActivity=0))}}else l.error("Не удалось запустить расширение.")}().catch((e=>{console.error(e)}))})()})();